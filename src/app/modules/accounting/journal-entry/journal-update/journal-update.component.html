<div class="flex flex-col w-full filter-article filter-interactive text-gray-700">
    
        <div class="flex flex-col m-2">
            <div class="text-3xl m-1 text-gray-100 p-2  bg-slate-600">Transaction</div>     
            <form [formGroup]="journalForm">
                <section class="flex flex-col md:flex-row">
                    <div class="flex flex-col grow">
                        <mat-form-field class="m-2 flex-start">
                            <mat-label class="ml-2 text-base">Journal Description</mat-label>
                            <input matInput placeholder="Journal Description" formControlName="description" />
                        </mat-form-field>
                    </div>
                    <div class="flex flex-col w-[150px]">
                        <mat-form-field class="m-2 flex-start">
                            <mat-label class="ml-2 text-base">Transaction Date</mat-label>
                            <input matInput formControlName="transaction_date" [matDatepicker]="picker">
                            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                    </div>
                </section>
                

            </form>
            <form [formGroup]="journalDetailForm">
                <div class="flex flex-col mt-2" >                                
                    <div class="text-3xl m-1 text-gray-100 p-2  bg-slate-600">Detail Update</div>    
                    <div class="flex flex-col h-full ml-1 mr-1 text-gray-800">
                        @if (details$ | async; as journal_details) {
                            <dx-data-grid 
                                id="journal_subid"
                                [wordWrapEnabled]="false" 
                                [dataSource]="journal_details"
                                [showColumnLines]="true" 
                                [showRowLines]="true" 
                                [showBorders]="true" 
                                [focusedRowEnabled]="true"
                                keyExpr="journal_subid" 
                                (onFocusedRowChanged)="onFocusedDetailRowChanged($event)"
                                (onCellDblClick)="onCellDoubleClicked($event)" 
                                [repaintChangesOnly]="false">
        
                                <dxi-column dataField="child" caption="Account" width="90"> </dxi-column>
                                <dxi-column dataField="fund" caption="Fund" width="90"> </dxi-column>
                                <dxi-column dataField="sub_type" caption="Sub Type" width="120"> </dxi-column>
                                <dxi-column dataField="description"> </dxi-column>
                                <dxi-column dataField="reference" width="220"> </dxi-column>
                                <dxi-column dataField="debit" dataType="number" width="120" alignment="right"
                                    [customizeText]="formatNumber"> </dxi-column>
                                <dxi-column dataField="credit" dataType="number" alignment="right"
                                    [customizeText]="formatNumber" width="120"> </dxi-column>
        
                                <dxo-summary>
                                    <dxi-total-item column="child" summaryType="count">
                                    </dxi-total-item>
                                    <dxi-total-item column="debit" summaryType="sum"
                                        [valueFormat]="{ type: 'currency', precision: 2, useCurrencyAccountingStyle: true}"
                                        displayFormat="{0}"></dxi-total-item>
                                    <dxi-total-item column="credit" summaryType="sum"
                                        [valueFormat]="{ type: 'currency', precision: 2, useCurrencyAccountingStyle: true}"
                                        displayFormat="{0}"> </dxi-total-item>
                                </dxo-summary>
                            </dx-data-grid>
                        }
                        </div>                
                    
                        <section class="flex flex-col md:flex-row mt-2">
                        
                        <div class="flex flex-col grow">                            
                            @if (accounts$ | async; as accounts) {
                            <mat-form-field class="flex-start ml-1 grow" appearance="outline">
                                <mat-label class="ml-2 text-base dark:text-gray-100">Account</mat-label>
                                <mat-select class="text-gray-800" placeholder="Account" formControlName="child" (selectionChange)="changeChildAccount($event)">
                                    @for (account of accounts; track account)  { 
                                        <mat-option [value]="account.child"> {{ account.child }} - {{account.description}} </mat-option>
                                    }
                                </mat-select>
                            </mat-form-field>
                            }
                        </div>
                        
                        <div class="flex flex-col grow ">
                        @if (subtype$ | async; as subtypes) 
                        {                        
                            <mat-form-field class="flex-col ml-1 mr-1 grow" appearance="outline">
                                <mat-label class="text-base">Sub Types</mat-label>
                                <mat-select class="text-gray-800" placeholder="Sub Type" formControlName="sub_type" (selectionChange)="changeSubtype($event)">
                                    @for (item of subtypes; track item) { 
                                        <mat-option [value]="item.subtype"> {{ item.subtype }} </mat-option> 
                                    }
                                </mat-select>
                            </mat-form-field>
                        }
                        </div>                        
                        
                        
                        <div class="flex flex-col grow">
                            @if (funds$ | async; as funds) 
                            {
                                <mat-form-field class="flex-col ml-1 mr-1" appearance="outline">
                                    <mat-label class="text-base">Funds</mat-label>
                                    <mat-select class="text-gray-800" placeholder="Fund" formControlName="fund" (selectionChange)="changeFund($event)">
                                    @for (item of funds; track item) {                                         
                                            <mat-option [value]="item.fund"> {{ item.fund }} </mat-option>  
                                        }
                                    </mat-select>
                                </mat-form-field>
                            }                            
                        </div>
                        
                    </section>
                    
                    <section class="flex flex-row">
                        <div class="flex flex-col grow">
                            <mat-form-field class="m-1 form-element grow" appearance="outline">
                                <mat-label class="ml-2 text-base dark:text-gray-100">Description</mat-label>
                                <input matInput placeholder="Description" formControlName="detail_description" />
                            </mat-form-field>
                        </div>

                        <div class="flex flex-col grow m-1">
                            <mat-form-field class="form-element" appearance="outline" width="200">
                                <mat-label class="text-base dark:text-gray-100">Reference</mat-label>
                                <input matInput placeholder="Reference" formControlName="reference" />
                            </mat-form-field>
                        </div>

                    </section>

                    <section class="flex flex-row">    
                        <div class="flex flex-col grow">
                            <mat-form-field class="m-1 form-element grow" appearance="outline">
                                <mat-label class="text-base dark:text-gray-100">Debit</mat-label>
                                <input type="text" mask="separator.2" [leadZero]="true" thousandSeparator=","
                                    class="text-right" matInput placeholder="Debit" formControlName="debit" />
                            </mat-form-field>
                        </div>
                        <div class="flex flex-col grow">
                            <mat-form-field class="m-1 form-element grow" appearance="outline">
                                <mat-label class="text-base dark:text-gray-100">Credit</mat-label>
                                <input type="text" mask="separator.2" [leadZero]="true" thousandSeparator=","
                                    class="text-right" matInput placeholder="Credit" formControlName="credit" />
                            </mat-form-field>
                        </div>
                    </section>   

                </div>                 
            </form>    
        </div>
    
    <div mat-dialog-actions class="m-1">
        <button mat-icon-button color="primary" class="m-1 bg-slate-200 text-gray-100"
            (click)="onUpdateJournalEntry()" matTooltip="Update" aria-label="hovered over">
            <mat-icon [svgIcon]="'feather:refresh-cw'"></mat-icon>
        </button>
        
        <button mat-icon-button color="primary" class="m-1 bg-slate-200 text-gray-100"
            (click)=" onAddLineJournalDetail()" matTooltip="Add Line" aria-label="hovered over">
            <mat-icon [svgIcon]="'feather:file-plus'"></mat-icon>
        </button>
        
        <button mat-icon-button color="primary" class="m-1 bg-slate-200 text-gray-100"
            (click)="onDelete($event)" matTooltip="Remove Line" aria-label="hovered over">                    
            <mat-icon [svgIcon]="'feather:trash'"></mat-icon>
        </button>
        
        <button mat-icon-button color="primary" 
            (click)="onAddEvidence()"  class="bg-gray-200 ml-1" matTooltip="Add Evidence" aria-label="Evidence">
            <mat-icon [svgIcon]="'feather:image'"></mat-icon>
        </button>

        <button mat-icon-button color="primary" 
        (click)="onCreateTemplate()" class="bg-gray-200 ml-1" matTooltip="Create Template" aria-label="Template">
            <mat-icon [svgIcon]="'feather:layout'"></mat-icon>
        </button>

        @if (bNewTransaction === true) {
        <button mat-icon-button color="primary" class="m-1 bg-slate-200 text-gray-100"
            (click)="closeDrawer()" matTooltip="Cancel" aria-label="hovered over">
            <mat-icon>close</mat-icon>
        </button>
        }
    </div>


</div>