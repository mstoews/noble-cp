<!-- Account Distribution Report -->

<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto -px-20" cdkScrollable>
    <!-- Main -->
    <div class="flex-auto p-6 sm:p-10">
        <div class="h-full border-gray-300 rounded-2xl">

            @if (dl$ | async; as dist)
            {
            <div class="flex flex-col h-full">
                <dist-menubar (notifyParentRefresh)="onRefresh()"
                    (notifyParentAdd)="onAdd()" (notifyParentPeriod)="onPeriodChanged($event)"
                    (notifyParentYear)="onYearChanged($event)"
                    [currentPeriod]="currentPeriod"
                    [currentYear]="currentYear">
                </dist-menubar>
                <dx-data-grid class="h-[600px]" [dataSource]="dist" [remoteOperations]="false"
                    [allowColumnReordering]="true" [rowAlternationEnabled]="true" [showBorders]="false"
                    [showRowLines]="false" [showColumnLines]="true" [focusedRowEnabled]="false" [focusedRowIndex]="0"
                    (onCellDblClick)="onCellDoubleClicked($event)" [repaintChangesOnly]="false"
                    (onExporting)="onExporting($event)"
                    (onContentReady)="onContentReady($event)" keyExpr="child">

                    <dxo-selection mode="single"></dxo-selection>
                    <dxo-search-panel [visible]="true"></dxo-search-panel>
                    <dxo-group-panel [visible]="true"></dxo-group-panel>
                    <dxo-grouping [autoExpandAll]="true"></dxo-grouping>
                    <dxo-scrolling mode="virtual"></dxo-scrolling>
                    <dxi-column dataField="account" width="130" dataType="number"></dxi-column>
                    <dxi-column dataField="child" caption="Sub Account" dataType="string" width="130"></dxi-column>
                    <dxi-column dataField="period" width="70" dataType="number"></dxi-column>
                    <dxi-column dataField="period_year" width="70" dataType="number"></dxi-column>
                    <dxi-column dataField="description" dataType="string"></dxi-column>
                    <dxi-column dataField="opening_balance" [customizeText]="formatNumber"  alignment="right" width="130"></dxi-column>
                    <dxi-column dataField="closing_balance" alignment="right" [customizeText]="formatNumber" width="130"></dxi-column>
                    <dxi-column dataField="update_date" dataType="date" width="100"></dxi-column>

                    <dxo-master-detail [enabled]="true" template="detail"> </dxo-master-detail>
                    <div *dxTemplate="let accounts of 'detail'">
                        <transaction-detail [period]="accounts.data.period" [year]="accounts.data.period_year" [account]="accounts.data.child"></transaction-detail>
                    </div>

                </dx-data-grid>
            </div>
            }
        </div>
    </div>

    <!--
    account             integer,
    child               integer,
    account_description varchar(100),
    period              integer,
    period_year         integer,
    journal_id          integer,
    description         varchar(100),
    opening_balance     numeric(16, 2),
    debit               numeric(16, 2),
    credit              numeric(16, 2),
    closing_balance     numeric(16, 2),
    create_date         date,
    create_user         varchar(20)
-->
